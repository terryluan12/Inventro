{% comment %} TODO: CHECK {% endcomment %}
{% extends "base.html" %}
{% load static %}

{#
  Edit Item page for inventory management. Displays a form pre-populated
  with the selected inventory and product item details. Only staff and
  administrators can access this page. On submission the item is updated
  in the database. The navigation matches the other dashboard pages.
#}

{% block content %}
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="brand">
        <div class="brand-icon"><i class="bi bi-box-seam"></i></div>
        <div>
          <div class="brand-title">Inventro</div>
          <div class="brand-sub">Inventory Platform</div>
        </div>
      </div>
      <nav class="menu">
        {% if user.is_authenticated and user.is_superuser %}
          <a class="menu-link" href="{% url 'add_user' %}"><i class="bi bi-person-plus"></i> Add User</a>
        {% endif %}
        <div class="menu-heading">Main</div>
        <a class="menu-link" href="{% url 'dashboard' %}"><i class="bi bi-speedometer2"></i> Dashboard</a>
        <a class="menu-link" href="{% url 'inventory' %}"><i class="bi bi-archive"></i> Inventory</a>
        {% if user.is_superuser or user.is_authenticated and user.is_staff %}
          <a class="menu-link" href="{% url 'add_item' %}"><i class="bi bi-plus-circle"></i> Add Item</a>
        {% endif %}
        {% if user.is_authenticated and user.is_superuser %}
          <a class="menu-link" href="{% url 'analytics' %}"><i class="bi bi-graph-up"></i> Analytics</a>
        {% endif %}
      </nav>
      <div class="sidebar-footer">
        <div class="avatar">{{ user.username|slice:":2"|upper }}</div>
        <div class="user-meta">
          <div class="user-name">
            {% if user.is_authenticated %}
              {{ user.username }}
            {% else %}
              Guest
            {% endif %}
          </div>
          <div class="user-role">
            {% if user.is_superuser %}
              Admin
            {% elif user.is_staff %}
              Manager
            {% elif user.is_authenticated %}
              Staff
            {% else %}
              Not signed in
            {% endif %}
          </div>
        </div>
        {% if user.is_authenticated %}
          <a class="logout" href="{% url 'logout' %}" title="Sign out"><i class="bi bi-box-arrow-right"></i></a>
        {% else %}
          <a class="logout" href="{% url 'login' %}" title="Sign in"><i class="bi bi-box-arrow-in-right"></i></a>
        {% endif %}
      </div>
    </aside>

    <!-- Main content -->
    <main class="main">
      <header class="topbar">
        <h1 class="h5 mb-0">Edit Inventory Item</h1>
      </header>
      <section class="container py-4">
        {% if error %}
          <div class="alert alert-danger">{{ error }}</div>
        {% endif %}
        <form method="post" class="row g-3">
          {% csrf_token %}
          <div class="col-md-6">
            <label class="form-label">Item Name *</label>
            <input class="form-control" type="text" name="name" value="{{ inv_item.name }}" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">SKU *</label>
            <input class="form-control" type="text" name="sku" value="{{ prod_item.SKU }}" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Category *</label>
            <input class="form-control" type="text" name="category" value="{{ prod_item.category.name }}" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Location *</label>
            <input class="form-control" type="text" name="location" value="{{ inv_item.location }}" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Quantity *</label>
            <input class="form-control" type="number" name="quantity" min="0" value="{{ inv_item.quantity }}" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Reorder Level *</label>
            <input class="form-control" type="number" name="reorder" min="0" value="{{ inv_item.reorder_level }}" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Price (per unit) $ *</label>
            <input class="form-control" type="number" step="0.01" name="price" min="0" value="{{ unit_price|floatformat:2 }}" required>
          </div>
          <div class="col-12 d-flex gap-2">
            <button type="submit" class="btn btn-primary">Save Changes</button>
            <a class="btn btn-outline-secondary" href="{% url 'inventory' %}">Cancel</a>
          </div>
        </form>
      </section>
    </main>
  </div>
{% endblock %}
